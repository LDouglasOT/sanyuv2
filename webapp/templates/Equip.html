{% extends "base.html" %}
{% block content %}

{% load form_tags %}
{% load widget_tweaks %}
{% load static %}

<section 
  class="donation-hero min-h-screen flex items-center justify-center relative overflow-hidden bg-cover bg-center" 
  style="background-image: url('https://firebasestorage.googleapis.com/v0/b/twinbrook-12f84.appspot.com/o/failure.jpg?alt=media&token=53b2047c-d565-44aa-83df-d025f26e99b7');"
>
  <div class="absolute inset-0 bg-gradient-to-r from-black/60 to-transparent"></div>
  
  <div class="relative z-10 text-center max-w-4xl mx-auto px-4">
    <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-6">
      Support Sanyu Hospital Expand Her Charitable Work
    </h1>
    <p class="text-xl text-white/90 mb-10">
     Thank you for your generous contribution. We assure you that every single coin you donate goes directly to our charitable programs, bringing healing and hope to underserved communities.

Your generosity fuels our mission, and we are deeply grateful for your support.
    </p>
    <div class="flex justify-center gap-6">
      <a href="#payment-form" class="bg-white text-blue-800 font-semibold px-6 py-3 rounded-lg hover:bg-gray-100 transition">Cash donation</a>
      <a href="#equipment-donation" class="bg-yellow-400 text-black font-semibold px-6 py-3 rounded-lg hover:bg-yellow-300 transition">Equipment donation</a>
    </div>
  </div>
</section>




<section class="max-w-5xl mx-auto py-12 px-4">



<section class="bg-base-100 py-16 px-6 md:px-20 bg-gradient-to-tr from-yellow-100 via-pink-100 to-orange-100 rounded-3xl shadow-2xl p-10 border border-pink-200">
  <div class="max-w-3xl mx-auto text-center">
    <h2 class="text-3xl md:text-4xl font-bold text-primary mb-6">Support Sanyu Hospital</h2>
    <p class="text-base-content mb-10">
      All funds received will be used to support the medical outreaches, equipment procurement, free treatment for the poor, etc. Your contribution brings health and hope to many. Thank you!
    </p>
 <h2 class="text-2xl font-semibold mb-6 text-center">Direct Bank Transfers</h2>
   
    <div class="space-y-6 text-left">
      <!-- Bank Account -->
      <div class="bg-gradient-to-tr from-yellow-100 via-pink-100 to-orange-100 rounded-3xl shadow-2xl p-10 border border-pink-200 rounded-box flex justify-between items-center">
        <div>
          <p class="font-semibold text-base-content">Bank Account (UGX)</p>
          <p id="bank-info" class="text-sm opacity-80">
            Sanyu Hospital Outreach - {{banks.account_number}} - {{banks.name}}
          </p>
          <p>swift code:  {{banks.name}} ibna:  {{banks.name}}</p>
        </div>
        <button class="btn btn-sm btn-outline btn-primary" onclick="copyText('bank-info')">
          Copy
        </button>
      </div>
    </div>

  </div>
  <br>
  <div class="dropdown w-full">
  <div tabindex="0" role="button" class="btn m-1 w-full bg-gradient-to-tr from-yellow-100 via-pink-100 to-orange-100 rounded-3xl shadow-2xl border border-pink-200">How To Do Bank Transfers</div>
  <div
    tabindex="0"
    class="dropdown-content card card-sm bg-base-100 z-1 w-full shadow-md">
    <div class="card-body">
      <section class="bg-base-100 py-16 px-6 md:px-20">
  <div class="max-w-3xl mx-auto text-center">
    <h2 class="text-3xl md:text-4xl font-bold text-primary mb-6">How to Make a Bank Transfer</h2>
    <p class="text-base-content mb-10">
      Follow these steps to complete your bank transfer securely and efficiently.
    </p>

    <div class="space-y-6 text-left">
      <!-- Step 1 -->
      <div class="bg-base-200 rounded-box p-4">
        <h3 class="font-semibold text-base-content mb-2">1. Gather Recipient's Bank Details</h3>
        <p class="text-sm opacity-80">
          Ensure you have the following information:
          <ul class="list-disc list-inside ml-4 mt-2">
            <li>Recipient's full name</li>
            <li>Bank name and branch</li>
            <li>Account number</li>
            <li>SWIFT/BIC code (for international transfers)</li>
            <li>IBAN (if applicable)</li>
          </ul>
        </p>
      </div>

      <!-- Step 2 -->
      <div class="bg-base-200 rounded-box p-4">
        <h3 class="font-semibold text-base-content mb-2">2. Choose Your Transfer Method</h3>
        <p class="text-sm opacity-80">
          You can initiate the transfer through:
          <ul class="list-disc list-inside ml-4 mt-2">
            <li>Online banking portal</li>
            <li>Mobile banking app</li>
            <li>Visiting a local bank branch</li>
            <li>Telephone banking (if available)</li>
          </ul>
        </p>
      </div>

      <!-- Step 3 -->
      <div class="bg-base-200 rounded-box p-4">
        <h3 class="font-semibold text-base-content mb-2">3. Initiate the Transfer</h3>
        <p class="text-sm opacity-80">
          Log in to your chosen platform and navigate to the 'Transfers' section. Enter the recipient's details accurately, specify the amount, and include a reference or note indicating the purpose of the transfer (e.g., "Donation for Medical Outreach").
        </p>
      </div>

      <!-- Step 4 -->
      <div class="bg-base-200 rounded-box p-4">
        <h3 class="font-semibold text-base-content mb-2">4. Review and Confirm</h3>
        <p class="text-sm opacity-80">
          Double-check all entered information for accuracy. Confirm the transfer and complete any required authentication steps, such as entering a security code or using two-factor authentication.
        </p>
      </div>

      <!-- Step 5 -->
      <div class="bg-base-200 rounded-box p-4">
        <h3 class="font-semibold text-base-content mb-2">5. Save the Confirmation</h3>
        <p class="text-sm opacity-80">
          After completing the transfer, save or print the transaction confirmation for your records. Note the transaction ID in case you need to reference it later.
        </p>
      </div>

      <!-- Additional Tips -->
      <div class="bg-base-200 rounded-box p-4">
        <h3 class="font-semibold text-base-content mb-2">Additional Tips</h3>
        <ul class="list-disc list-inside text-sm opacity-80 ml-4 mt-2">
          <li><strong>Processing Time:</strong> Domestic transfers typically process within the same day, while international transfers may take 1‚Äì5 business days.</li>
          <li><strong>Fees:</strong> Be aware of any fees associated with the transfer, especially for international transactions.</li>
          <li><strong>Exchange Rates:</strong> For international transfers, consider the current exchange rate, as it can affect the final amount received.</li>
          <li><strong>Security:</strong> Ensure you're using secure networks when performing online or mobile banking to protect your financial information.</li>
        </ul>
      </div>
    </div>
  </div>
</section>

    </div>
  </div>
</div>
</section>


<!-- Copy Script -->
<script>
  function copyText(elementId) {
    const text = document.getElementById(elementId).innerText;
    navigator.clipboard.writeText(text).then(() => {
      alert('Copied to clipboard!');
    });
  }
</script>



  <hr class="">
 <div class="max-w-5xl mx-auto py-12 px-14">
  <div class="bg-gradient-to-tr from-yellow-100 via-pink-100 to-orange-100 rounded-3xl shadow-2xl w-full p-8 border border-pink-300">
    <h2 class="text-3xl font-bold mb-8 text-center text-pink-700">
      üí≥ Pesapal Payment (Visa, Mastercards, Mobile Money, EezyPay)
    </h2>

    <form id="payment-form" class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-3xl mx-auto p-6 bg-white rounded-2xl shadow-lg border border-pink-200">

      <!-- Inputs -->
      <input type="email" id="email_address" placeholder="üìß Email Address" required
        class="w-full px-5 py-3 rounded-xl border-2 border-pink-200 focus:ring-4 focus:ring-pink-300 shadow-sm bg-white placeholder-pink-400 transition duration-200 focus:outline-none" />

      <input type="text" id="phone_number" placeholder="üì± Phone Number" required
        class="w-full px-5 py-3 rounded-xl border-2 border-pink-200 focus:ring-4 focus:ring-pink-300 shadow-sm bg-white placeholder-pink-400 transition duration-200 focus:outline-none" />

      <input type="text" id="first_name" placeholder="üòä First Name" required
        class="w-full px-5 py-3 rounded-xl border-2 border-pink-200 focus:ring-4 focus:ring-pink-300 shadow-sm bg-white placeholder-pink-400 transition duration-200 focus:outline-none" />

      <input type="text" id="last_name" placeholder="üßë Last Name" required
        class="w-full px-5 py-3 rounded-xl border-2 border-pink-200 focus:ring-4 focus:ring-pink-300 shadow-sm bg-white placeholder-pink-400 transition duration-200 focus:outline-none" />

      <input type="text" id="line_1" placeholder="üè† Address Line 1" required
        class="w-full px-5 py-3 rounded-xl border-2 border-pink-200 focus:ring-4 focus:ring-pink-300 shadow-sm bg-white placeholder-pink-400 transition duration-200 focus:outline-none" />

      <input type="text" id="city" placeholder="üåÜ City" required
        class="w-full px-5 py-3 rounded-xl border-2 border-pink-200 focus:ring-4 focus:ring-pink-300 shadow-sm bg-white placeholder-pink-400 transition duration-200 focus:outline-none" />

      <input type="number" id="amount" placeholder="üí∞ Amount" min="1" step="0.01" required
        class="w-full px-5 py-3 rounded-xl border-2 border-pink-200 focus:ring-4 focus:ring-pink-300 shadow-sm bg-white placeholder-pink-400 transition duration-200 focus:outline-none" />

      <select id="currency" required
        class="w-full px-5 py-3 rounded-xl border-2 border-pink-200 focus:ring-4 focus:ring-pink-300 shadow-sm bg-white text-pink-700 transition duration-200 focus:outline-none">
        <option value="" disabled selected>üí± Select Currency</option>
        <option value="KES">KES - Kenyan Shilling</option>
        <option value="UGX">UGX - Ugandan Shilling</option>
        <option value="TZS">TZS - Tanzanian Shilling</option>
        <option value="RWF">RWF - Rwandan Franc</option>
        <option value="USD">USD - US Dollar</option>
      </select>

      <select id="department" required
        class="w-full px-5 py-3 rounded-xl border-2 border-pink-200 focus:ring-4 focus:ring-pink-300 shadow-sm bg-white text-pink-700 transition duration-200 focus:outline-none">
        <option disabled selected>üè¢ Pick a Department to donate to</option>
        {% for dep in departments %}
          <option>{{ dep.name }}</option>
        {% endfor %}
      </select>

      <!-- Submit button -->
      <div class="md:col-span-2">
        <button type="submit" id="submit-btn"
          class="w-full bg-gradient-to-r from-pink-400 to-yellow-400 text-white font-semibold py-3 rounded-xl shadow-md hover:from-pink-500 hover:to-yellow-500 transition duration-300 text-xl">
          üöÄ Donate
        </button>
      </div>

      <!-- Loader -->
      <div id="loader" class="md:col-span-2 flex justify-center mt-4 hidden">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" width="200" height="200" style="shape-rendering: auto; display: block;">
  <g><g transform="translate(80,50)">
    <g transform="rotate(0)">
      <circle fill-opacity="1" fill="#ff727d" r="6" cy="0" cx="0">
        <animateTransform repeatCount="indefinite" dur="1s" keyTimes="0;1" values="1.5 1.5;1 1" begin="-0.875s" type="scale" attributeName="transform"/>
        <animate begin="-0.875s" values="1;0" repeatCount="indefinite" dur="1s" keyTimes="0;1" attributeName="fill-opacity"/>
      </circle>
    </g>
  </g><g transform="translate(71.21320343559643,71.21320343559643)">
    <g transform="rotate(45)">
      <circle fill-opacity="0.875" fill="#ff727d" r="6" cy="0" cx="0">
        <animateTransform repeatCount="indefinite" dur="1s" keyTimes="0;1" values="1.5 1.5;1 1" begin="-0.75s" type="scale" attributeName="transform"/>
        <animate begin="-0.75s" values="1;0" repeatCount="indefinite" dur="1s" keyTimes="0;1" attributeName="fill-opacity"/>
      </circle>
    </g>
  </g><g transform="translate(50,80)">
    <g transform="rotate(90)">
      <circle fill-opacity="0.75" fill="#ff727d" r="6" cy="0" cx="0">
        <animateTransform repeatCount="indefinite" dur="1s" keyTimes="0;1" values="1.5 1.5;1 1" begin="-0.625s" type="scale" attributeName="transform"/>
        <animate begin="-0.625s" values="1;0" repeatCount="indefinite" dur="1s" keyTimes="0;1" attributeName="fill-opacity"/>
      </circle>
    </g>
  </g><g transform="translate(28.786796564403577,71.21320343559643)">
    <g transform="rotate(135)">
      <circle fill-opacity="0.625" fill="#ff727d" r="6" cy="0" cx="0">
        <animateTransform repeatCount="indefinite" dur="1s" keyTimes="0;1" values="1.5 1.5;1 1" begin="-0.5s" type="scale" attributeName="transform"/>
        <animate begin="-0.5s" values="1;0" repeatCount="indefinite" dur="1s" keyTimes="0;1" attributeName="fill-opacity"/>
      </circle>
    </g>
  </g><g transform="translate(20,50.00000000000001)">
    <g transform="rotate(180)">
      <circle fill-opacity="0.5" fill="#ff727d" r="6" cy="0" cx="0">
        <animateTransform repeatCount="indefinite" dur="1s" keyTimes="0;1" values="1.5 1.5;1 1" begin="-0.375s" type="scale" attributeName="transform"/>
        <animate begin="-0.375s" values="1;0" repeatCount="indefinite" dur="1s" keyTimes="0;1" attributeName="fill-opacity"/>
      </circle>
    </g>
  </g><g transform="translate(28.78679656440357,28.786796564403577)">
    <g transform="rotate(225)">
      <circle fill-opacity="0.375" fill="#ff727d" r="6" cy="0" cx="0">
        <animateTransform repeatCount="indefinite" dur="1s" keyTimes="0;1" values="1.5 1.5;1 1" begin="-0.25s" type="scale" attributeName="transform"/>
        <animate begin="-0.25s" values="1;0" repeatCount="indefinite" dur="1s" keyTimes="0;1" attributeName="fill-opacity"/>
      </circle>
    </g>
  </g><g transform="translate(49.99999999999999,20)">
    <g transform="rotate(270)">
      <circle fill-opacity="0.25" fill="#ff727d" r="6" cy="0" cx="0">
        <animateTransform repeatCount="indefinite" dur="1s" keyTimes="0;1" values="1.5 1.5;1 1" begin="-0.125s" type="scale" attributeName="transform"/>
        <animate begin="-0.125s" values="1;0" repeatCount="indefinite" dur="1s" keyTimes="0;1" attributeName="fill-opacity"/>
      </circle>
    </g>
  </g><g transform="translate(71.21320343559643,28.78679656440357)">
    <g transform="rotate(315)">
      <circle fill-opacity="0.125" fill="#ff727d" r="6" cy="0" cx="0">
        <animateTransform repeatCount="indefinite" dur="1s" keyTimes="0;1" values="1.5 1.5;1 1" begin="0s" type="scale" attributeName="transform"/>
        <animate begin="0s" values="1;0" repeatCount="indefinite" dur="1s" keyTimes="0;1" attributeName="fill-opacity"/>
      </circle>
    </g>
  </g><g/></g><!-- [ldio] generated by https://loading.io -->
</svg>

      </div>

      <!-- Message -->
      <div id="message" class="md:col-span-2 text-center text-pink-600 mt-4 font-medium"></div>
    </form>
  </div>
</div>




  <hr class="my-10">
<!-- Payment Iframe -->
<!-- Loader Modal -->
<div id="loader-modal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center hidden z-50">
  <div class="bg-white p-6 rounded-lg shadow-lg text-center">
    <p class="text-lg font-semibold mb-4">Redirecting to secure payment gateway...</p>
    <svg class="animate-spin h-8 w-8 text-blue-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
    </svg>
  </div>
</div>


</section>

<div class="max-w-4xl mx-auto py-12 px-6">
  <div class="bg-gradient-to-tr from-yellow-100 via-pink-100 to-orange-100 rounded-3xl shadow-2xl p-10 border border-pink-200">
    <h2 class="text-4xl font-bold text-center text-pink-700 mb-6">
      üéÅ Donate Equipment
    </h2>

    <form id="equipment-donation" action="https://formspree.io/f/mjkrkwbj" method="POST" class="space-y-6">
      <!-- Donor Info -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <input type="text" name="first_name" placeholder="üòä First Name" required
          class="w-full px-5 py-3 rounded-xl border-2 border-pink-200 focus:ring-4 focus:ring-pink-300 shadow-sm bg-white placeholder-pink-400 transition duration-200" />
        <input type="text" name="last_name" placeholder="üßë Last Name" required
          class="w-full px-5 py-3 rounded-xl border-2 border-pink-200 focus:ring-4 focus:ring-pink-300 shadow-sm bg-white placeholder-pink-400 transition duration-200" />
        <input type="email" name="email" placeholder="üìß Email Address" required
          class="w-full px-5 py-3 rounded-xl border-2 border-pink-200 focus:ring-4 focus:ring-pink-300 shadow-sm bg-white placeholder-pink-400 transition duration-200" />
        <input type="tel" name="phone" placeholder="üì± Phone Number"
          class="w-full px-5 py-3 rounded-xl border-2 border-pink-200 focus:ring-4 focus:ring-pink-300 shadow-sm bg-white placeholder-pink-400 transition duration-200" />
      </div>

      <!-- Equipment Info -->
      <div>
        <input type="text" name="equipment_name" placeholder="üì¶ Equipment Name" required
          class="w-full px-5 py-3 rounded-xl border-2 border-pink-200 focus:ring-4 focus:ring-pink-300 shadow-sm bg-white placeholder-pink-400 transition duration-200" />
      </div>
      <div>
        <textarea name="equipment_description" rows="4" placeholder="üìù Description of Equipment" required
          class="w-full px-5 py-3 rounded-xl border-2 border-pink-200 focus:ring-4 focus:ring-pink-300 shadow-sm bg-white placeholder-pink-400 transition duration-200 resize-none"></textarea>
      </div>
      <div>
        <input type="text" name="condition" placeholder="‚öôÔ∏è Condition (e.g. New, Used)" required
          class="w-full px-5 py-3 rounded-xl border-2 border-pink-200 focus:ring-4 focus:ring-pink-300 shadow-sm bg-white placeholder-pink-400 transition duration-200" />
      </div>

      <!-- Address Info -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <input type="text" name="line_1" placeholder="üè† Address Line 1" required
          class="w-full px-5 py-3 rounded-xl border-2 border-pink-200 focus:ring-4 focus:ring-pink-300 shadow-sm bg-white placeholder-pink-400 transition duration-200" />
        <input type="text" name="city" placeholder="üåÜ City" required
          class="w-full px-5 py-3 rounded-xl border-2 border-pink-200 focus:ring-4 focus:ring-pink-300 shadow-sm bg-white placeholder-pink-400 transition duration-200" />
      </div>

      <button type="submit" id="submit-btn"
        class="w-full bg-gradient-to-r from-pink-400 to-yellow-400 text-white font-semibold py-3 rounded-xl shadow-md hover:from-pink-500 hover:to-yellow-500 transition duration-300 text-xl">
        üöÄ Donate Now
      </button>

      <div id="loader" class="flex justify-center mt-4 hidden">
        <!-- You can reuse your SVG loader here -->
      </div>

      <div id="message" class="text-center text-red-500 mt-4 font-medium"></div>
    </form>
  </div>
</div>



<!-- Floating Button -->
<button id="issue-button"
  class="hidden md:block md:fixed bottom-80 h-80 right-80 md:right-0 bg-teal-900 text-white px-4 py-2 text-sm rounded shadow-md hover:bg-red-600 z-50">
  <div>
    <h1 class="underling font-bold text-xl">Donation issues?</h1>
    <p class="flex wrap">Hello our dear donor,<br> please click here if you <br> are facing issues donating <br> via our page. <br> We will reach out <br> to you so we can help</p>
  </div>
  <div class="bg-green-500 rounded py-8 my-2 text-xl">Help</div>
</button>
<button id="mobile-issue-button"
  class="fixed bottom-4 right-4 bg-teal-900 text-white px-3 py-2 text-xs rounded-full shadow-md hover:bg-red-600 z-50 md:hidden">
  Donation issues ?
</button>

<!-- Hidden Form Above the Button -->
<div id="issue-form"
  class="hidden fixed bottom-16 right-4 bg-white border border-gray-300 rounded-lg shadow-lg p-4 w-72 z-50 md:hidden">
  <h2 class="text-sm font-bold mb-2">Facing a Donation Issue?</h2>
  <form id="help-form" class="space-y-2">
    <input type="text" name="name" placeholder="Full Name"
      class="w-full border rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-teal-500" required>
    <input type="text" name="contact" placeholder="Phone or Email"
      class="w-full border rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-teal-500" required>
    <textarea name="issue" placeholder="Brief description of the issue"
      class="w-full border rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-teal-500" rows="3" required></textarea>
    <button type="submit"
      class="bg-teal-700 text-white w-full py-1 rounded hover:bg-teal-800 text-sm">Submit</button>
  </form>
</div>

<!-- Script to Toggle Form -->
<script>
  const helpBtn = document.getElementById('mobile-issue-button');
  const form = document.getElementById('issue-form');

  helpBtn.addEventListener('click', () => {
    form.classList.toggle('hidden');
  });
</script>

<!-- Popup Form -->
<div id="issue-popup"
  class="hidden fixed h-80 bottom-80 right-40 md:right-48 bg-teal-500 shadow-lg rounded-lg w-[90%] max-w-sm p-4 z-50">
  <form action="https://formspree.io/f/mjkrkwbj" method="POST">
    <h3 class="text-lg font-semibold mb-2">Let us know</h3>
    <input type="text" name="full_name" placeholder="Full Name" required
      class="w-full px-3 py-2 mb-2 border rounded">
    <input type="email" name="email" placeholder="Email Address" required
      class="w-full px-3 py-2 mb-2 border rounded">
    <textarea name="issue" placeholder="Describe your issue..." rows="3" required
      class="w-full px-3 py-2 mb-2 border rounded"></textarea>
    <div class="flex justify-end gap-2">
      <button type="button" id="close-popup"
        class="text-sm text-gray-600 hover:text-black">Cancel</button>
      <button type="submit"
        class="bg-teal-900 text-white px-3 py-1 rounded text-sm hover:bg-teal-800">Submit</button>
    </div>
  </form>
</div>



<script>
  // Function to get the CSRF token from cookies
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      // Does this cookie string begin with the name we want?
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}

const element = document.querySelector('.payment-iframe');
console.log(element);
document.getElementById('payment-form').addEventListener('submit', async function(e) {
  e.preventDefault(); // Prevent the default form submission

  const submitBtn = document.getElementById('submit-btn');
  const loader = document.getElementById('loader');
  const messageDiv = document.getElementById('message');

  submitBtn.disabled = true;
  loader.classList.remove('hidden');
  messageDiv.textContent = '';

  // Collect form data
  const formData = {
    email_address: document.getElementById('email_address').value,
    phone_number: document.getElementById('phone_number').value,
    first_name: document.getElementById('first_name').value,
    last_name: document.getElementById('last_name').value,
    line_1: document.getElementById('line_1').value,
    city: document.getElementById('city').value,
    amount: parseFloat(document.getElementById('amount').value),
    currency: document.getElementById('currency').value,
    reason: document.getElementById('department').value
  };
  console.log(formData);
  // Validate amount and currency
  if (!formData.amount || formData.amount <= 0) {
    messageDiv.textContent = 'Please enter a valid amount.';
    submitBtn.disabled = false;
    loader.classList.add('hidden');
    return;
  }

  if (!formData.currency) {
    messageDiv.textContent = 'Please select a currency.';
    submitBtn.disabled = false;
    loader.classList.add('hidden');
    return;
  }

  // Prepare payload
  const payload = {
    currency: formData.currency,
    amount: formData.amount,
    description: "Payment for services",
    callback_url: "https://yourdomain.com/thanks/",
    notification_id: "your-notification-id",
    email_address: formData.email_address,
    phone_number: formData.phone_number,
    country_code: formData.currency === 'USD' ? 'US' : formData.currency.slice(0, 2),
    first_name: formData.first_name,
    last_name: formData.last_name,
    line_1: formData.line_1,
    city: formData.city,
    reason: formData.reason,
    
  };

  try {
    const response = await fetch("{% url 'submit_order' %}", {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': getCookie('csrftoken') // Ensure CSRF token is included
      },
      body: JSON.stringify(payload),
      credentials: 'same-origin'
    });

    const data = await response.json();

    if (response.ok && data.redirect_url) {
      // Redirect to payment page
        element.innerHTML = `
        <div class="flex flex-col justify-center items-center h-screen w-10/12 bg-gray-50">
          <p class="text-lg text-gray-700 mb-4">Loading secure payment gateway...</p>
          <iframe src="${data.redirect_url}" class="w-full h-full" frameborder="0"></iframe>
        </div>`;
    } else if (data.error) {
      messageDiv.textContent = data.error;
    } else {
      throw new Error(data.message || 'Payment initiation failed.');
    }
  } catch (error) {
    messageDiv.textContent = error.message;
  } finally {
    loader.classList.add('hidden');
    submitBtn.disabled = false;
  }
});

</script>


<script>
  const issueBtn = document.getElementById('issue-button');
  const issuePopup = document.getElementById('issue-popup');
  const closePopup = document.getElementById('close-popup');

  issueBtn.addEventListener('click', () => {
    issuePopup.classList.toggle('hidden');
  });

  closePopup.addEventListener('click', () => {
    issuePopup.classList.add('hidden');
  });

  // Optional: Close popup when clicking outside
  document.addEventListener('click', function (e) {
    if (!issuePopup.contains(e.target) && !issueBtn.contains(e.target)) {
      issuePopup.classList.add('hidden');
    }
  });

document.addEventListener('DOMContentLoaded', () => {
  const popup = document.getElementById('issue-popup');
  const form = popup.querySelector('form');
  const closeBtn = document.getElementById('close-popup');

  // Create loader element
  const loader = document.createElement('div');
  loader.className = 'loader hidden mt-2 text-white text-center';
  loader.textContent = 'Sending...';
  form.appendChild(loader);

  // Create success message element
  const successMessage = document.createElement('div');
  successMessage.className = 'success-message hidden mt-2 text-white text-center';
  successMessage.textContent = 'Thank you! We will contact you shortly.';
  form.appendChild(successMessage);

  // Close popup on cancel button click
  closeBtn.addEventListener('click', () => {
    popup.classList.add('hidden');
    resetForm();
  });

  // Handle form submission
  form.addEventListener('submit', (e) => {
    e.preventDefault();

    loader.classList.remove('hidden');
    successMessage.classList.add('hidden');

    const formData = new FormData(form);

    fetch(form.action, {
      method: 'POST',
      body: formData,
      headers: {
        'Accept': 'application/json'
      }
    }).then(response => {
      loader.classList.add('hidden');
      if (response.ok) {
        successMessage.classList.remove('hidden');
        form.reset();
        setTimeout(() => {
          popup.classList.add('hidden');
          successMessage.classList.add('hidden');
        }, 3000);
      } else {
        alert('Oops! There was a problem submitting your form.');
      }
    }).catch(() => {
      loader.classList.add('hidden');
      alert('Oops! There was a problem submitting your form.');
    });
  });

  function resetForm() {
    form.reset();
    loader.classList.add('hidden');
    successMessage.classList.add('hidden');
  }
});


</script>


{% endblock %}
